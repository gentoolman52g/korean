제품 요구사항 정의서 (PRD - Product Requirements Document)

1. 개요 및 목표
1.1. 배경:
사내 AI 자동화 앱 '미소' 및 RAG 시스템의 지식 베이스 구축을 위해, 임직원들이 보유한 다양한 형태의 문서(법령, 엑셀, 논문 등)를 정제된 텍스트 데이터로 변환해야 합니다.
RAG 시스템의 검색 정확도와 답변 품질은 입력되는 데이터의 정제 수준과 청킹(Chunking) 전략에 크게 좌우됩니다.

1.2. 문제 정의:
다양한 포맷(PDF, Excel, HWP 등)의 원본 문서는 불필요한 서식, 반복되는 헤더/푸터, 깨진 문자 등을 포함하고 있어 RAG 시스템에 바로 등록하기 어렵습니다.
문서의 구조(표, 조항, 섹션)를 무시하고 단순 문자 수로만 자를 경우, 문맥이 끊겨 검색 품질이 저하됩니다.

1.3. 목표:
사용자가 파일을 직접 업로드하면, 문서 유형(법령, 엑셀, 논문 등)에 최적화된 방식으로 텍스트를 추출, 전처리, 청킹하는 웹 서비스를 제공합니다.
시각화 도구를 통해 전처리 결과를 직관적으로 검토하고 수정하여 고품질의 RAG 데이터를 생성합니다.

2. 사용자 및 사용 시나리오
2.1. 주요 사용자: RAG 시스템에 데이터를 등록하고자 하는 관리자 및 임직원

2.2. 사용자 시나리오 (User Flow):
1. 사용자는 전처리 시스템 웹 페이지에 접속하여 파일을 업로드합니다.
2. 시스템은 파일 확장자를 분석하여 텍스트를 추출하고(자체 처리 또는 Miso API 연동), 적절한 문서 유형(법령, 엑셀 등)을 제안합니다.
3. 사용자는 추출된 원본 텍스트를 확인하고, 문서 유형을 확정한 뒤 '전처리 시작'을 클릭합니다.
4. 시스템은 선택된 유형에 맞춰 노이즈 제거, 구조적 청킹을 수행합니다.
5. 사용자는 전처리된 텍스트와 시각화된 청크 흐름(Flow Viewer)을 확인하고, 필요 시 내용을 수정합니다.
6. 검토가 완료되면 '다운로드' 버튼을 클릭하여 RAG 등록용 포맷(@@@ 구분자 포함)의 .txt 파일을 내려받습니다.

3. 기능 요구사항

| ID | 기능명 | 상세 설명 | 우선순위 |
| :--- | :--- | :--- | :--- |
| **FR-01** | **파일 업로드 및 텍스트 추출** | - 다양한 포맷(PDF, Excel, Word, HWP 등)의 파일 업로드 지원<br>- **Excel**: Web Worker를 활용한 클라이언트 사이드 비동기 처리, 시트별 분리 및 마크다운 표 변환<br>- **일반 텍스트**: 브라우저 즉시 로드 (txt, md, json, csv 등)<br>- **복합 문서**: Miso API 연동을 통한 텍스트 추출 (PDF, HWP, Word 등)<br>- 대용량 파일(50MB) 처리 및 에러 핸들링 | 필수 |
| **FR-02** | **문서 유형별 전처리** | - **공통**: 중복 문단 제거, 공백/줄바꿈 정규화(Normalization), 특수문자 및 노이즈 제거<br>- **법령**: '제N조' 단위 구조 인식 및 보존, 조항 단위 청킹<br>- **논문**: 반복되는 페이지 헤더/푸터 패턴 분석 및 자동 제거, 섹션(I., 1.1 등) 구조 인식<br>- **엑셀**: 헤더 행 보존, 시트 단위 구분, 표 구조 유지 | 필수 |
| **FR-03** | **구조적 청킹 (Chunking)** | - **재귀적 분할 (Recursive Split)**: 문단(\n\n) > 문장(\n) > 마침표(.) 순으로 의미 단위 우선 분할<br>- **오버랩 (Overlap)**: 청크 간 문맥 유지를 위한 겹침 처리 (기본 200자)<br>- **표 보존**: 마크다운 표가 잘릴 경우 헤더를 반복 삽입하여 문맥 유지<br>- 청크 간 '@@@' 구분자 삽입 | 필수 |
| **FR-04** | **편집 및 검토 UI** | - **모드 전환**: 마크다운 미리보기(Preview)와 원본 편집(Edit) 모드 전환 제공<br>- **스크롤 동기화**: 편집 위치와 미리보기 위치 간의 양방향 스크롤 및 커서 위치 동기화<br>- 문서 유형 선택 및 실시간 전처리 결과 확인<br>- 처리 상태(로딩, 완료, 에러)에 따른 피드백 제공 | 필수 |
| **FR-05** | **청크 시각화 (Visualization)** | - **Flow Viewer**: 청크 간의 흐름을 시각적으로 보여주는 뷰어<br>- **Chunk Modal**: 개별 청크의 내용을 상세히 확인하는 모달 창 | 필수 |
| **FR-06** | **결과 다운로드** | - 최종 검토된 텍스트를 .txt 파일로 다운로드<br>- 파일명 자동 생성 (예: `[전처리] 원본파일명.txt`) | 필수 |

### 3.1. 문서 유형별 상세 전처리 전략

구현된 전처리 엔진(`text-preprocessor.ts`)은 문서 유형에 따라 다음과 같은 차별화된 전략을 수행합니다.

| 문서 유형 | 목표 구조 | 상세 알고리즘 및 로직 |
| :--- | :--- | :--- |
| **법령 및 사규**<br>(Law/Regulation) | **조/항 단위** | - **구조 인식**: `제N조`, `제N장` 등의 패턴을 정규식으로 식별하여 문서의 뼈대를 파악<br>- **단위 보존**: 조항 중간이 잘리지 않도록 '조' 단위를 하나의 블록으로 유지<br>- **스마트 병합**: 내용이 짧은 조항들은 최대 청크 크기(예: 4000자) 내에서 문맥이 끊기지 않게 병합 |
| **논문 및 보고서**<br>(Research Paper) | **섹션 단위** | - **헤더/푸터 제거**: 전체 라인의 1% 이상 반복해서 등장하는 짧은 텍스트(페이지 번호, 저널명 등)를 노이즈로 간주하여 자동 삭제<br>- **섹션 청킹**: `1. 서론`, `2.1 연구방법` 등 계층적 번호 체계를 인식하여 섹션 단위로 분할<br>- **재귀적 분할**: 섹션 내용이 너무 길 경우 문단 > 문장 순으로 재귀적 분할 수행 |
| **엑셀**<br>(Excel/Spreadsheet) | **표/행 단위** | - **시트 독립성**: 각 시트를 `[Sheet: 이름]` 태그로 구분하여 독립적인 문맥으로 처리<br>- **마크다운 변환**: 2차원 데이터를 LLM이 이해하기 쉬운 마크다운 표(`|...|`) 형식으로 변환<br>- **헤더 반복**: 청크가 나뉠 때마다 **컬럼 헤더를 자동으로 반복 삽입**하여, 중간 데이터만 보더라도 어떤 열인지 파악 가능하도록 함 |
| **일반/기타**<br>(General) | **의미 단위** | - **표 보존**: 텍스트 내의 마크다운 표 구조를 감지하여, 표 중간이 잘리지 않도록 통째로 처리하거나 헤더를 포함하여 분할<br>- **재귀적 청킹**: `\n\n`(문단) → `\n`(줄바꿈) → `.`(마침표) 순으로 텍스트를 쪼개어 문장의 의미 훼손 최소화<br>- **오버랩**: 청크 간 200자 내외의 오버랩을 두어 경계 부분의 정보 손실 방지 |

4. 비기능 요구사항
| ID | 항목 | 상세 설명 |
| :--- | :--- | :--- |
| NFR-01 | 성능 | - 50MB 이내의 파일 처리는 수 초~수십 초 내에 완료되어야 함 (외부 API 의존성 제외) |
| NFR-02 | 사용성 | - 복잡한 설정 없이 파일 업로드 -> 클릭 -> 다운로드의 단순한 흐름 유지 |
| NFR-03 | 확장성 | - 향후 새로운 문서 유형이나 전처리 로직 추가가 용이한 구조(Strategy Pattern 등) 유지 |

5. 범위 외 (Out of Scope)
- 사용자 로그인/회원가입 (사내망 접속 가정 또는 별도 인증 게이트웨이)
- HWP 파일의 직접 파싱 (Miso API에 위임)
- RAG 벡터 DB에 대한 직접 적재 (파일 다운로드까지만 담당)
